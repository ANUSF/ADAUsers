<%
  require 'java' if defined?(JRUBY_VERSION)

  file = ENV['OID_DBCONFIG'] ||
    ( defined?(JRUBY_VERSION) && java.lang.System.getProperty('oid.dbconfig')) ||
    ( defined?(JRUBY_VERSION) && defined?($servlet_context) &&
      $servlet_context.get_init_parameter('oid.dbconfig') ) ||
    File.join(ENV['HOME'], 'etc', 'assda', 'dbconfig.yml')

  @conf = File.exist?(file) && YAML::load(File.open(file))[Rails.env] || {}
%>
template: &template
  adapter:  <%= (defined?(JRUBY_VERSION) && @conf['jdbc']) || @conf['adapter'] %>
  pool:     5
  timeout:  5000
  database: <%= @conf['database'] %>
  host:     <%= @conf['host'] %>
  username: <%= @conf['username'] %>
  password: <%= @conf['password'] %>

production:
  <<: *template

development:
  <<: *template

test:
  <<: *template
