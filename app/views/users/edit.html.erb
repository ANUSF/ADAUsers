<% content_for(:title) { "Editing #{@user.user}" } %>
<h2>User details</h2>

<table>
  <tr><td>Name:</td><td><%= @user.name %></td>
  <tr><td>Username:</td><td><%= @user.user %></td></tr>
  <tr><td>Email address:</td><td><%= @user.email %></td></tr>
  <tr><td>Affiliation:</td><td><%= @user.affiliation %></td></tr>
  <tr><td>Type of work:</td><td><%= @user.action %></td></tr>
  <tr><td>Member for:</td><td><%= time_ago_in_words(@user.dateregistered) %></td></tr>
  <tr><td>Last access:</td><td><%= @user.last_access_time ? time_ago_in_words(@user.last_access_time)+" ago" : "Never" %></td></tr>
  <tr><td>Number of accesses<br />(last 12 months / all time):</td><td><%= @user.num_accesses_in_past(1.year) %> / <%= @user.num_accesses_in_past %></td></tr>

  <tr id="acspri">
    <td>ACSPRI member?</td>
    <td>
      <%= form_for @user do |form| %>
        <%= acsprimember_to_s(@user.acsprimember) %>
        <%= form.hidden_field :acsprimember, :value => (1-@user.acsprimember).abs %>
        <%= form.submit @user.acsprimember? ? "Revoke membership" : "Grant membership" %>
      <% end %>
    </td>
  </tr>
  <tr id="role">
    <td>Role:</td>
    <td>
      <%= form_for @user do |form| %>
        <%= form.collection_select :user_role, RoleEjb.all, :id, :id, {:selected => @user.user_role } %>
        <%= form.submit "Change" %>
      <% end %>
   </td>
  </tr>
</table>

<hr />

<div id="category_a">
  <h2>Category A Datasets</h2>

  <%= render 'users/datasets_table', :table_name => :pending, :table_data => @datasetsPendingA, :category => :a %>
  <%= render 'users/datasets_table', :table_name => :accessible, :table_data => @datasetsAccessibleA, :category => :a %>

  <%= render 'users/datasets_add_form', :datasets => @datasetsCatA, :category => :a %>
</div>


<hr />

<div id="category_b">
  <h2>Category B Datasets</h2>

  <%= render 'users/datasets_table', :table_name => :pending, :table_data => @datasetsPendingB, :category => :b %>
  <%= render 'users/datasets_table', :table_name => :accessible, :table_data => @datasetsAccessibleB, :category => :b %>

  <%= render 'users/datasets_add_form', :datasets => @datasetsCatB, :category => :b %>
</div>
