<h2>User details</h2>

<table>
  <tr><td>Username:</td><td><%= @user.user %></td></tr>
  <tr><td>Email address:</td><td><%= @user.email %></td></tr>
  <tr id="acspri">
    <td>ACSPRI member?</td>
    <td>
      <%= form_for @user do |form| %>
        <%= @user.acsprimember? ? "Yes" : "No" %>
        <%= form.hidden_field :acsprimember, :value => 1-@user.acsprimember %>
        <%= form.submit "Change" %>
      <% end %>
    </td>
  </tr>
  <tr id="role">
    <td>Role:</td>
    <td>
      <%= form_for @user do |form| %>
        <%= form.collection_select :user_role, RoleEjb.all, :id, :id, {:selected => @user.user_role } %>
        <%= form.submit "Change" %>
      <% end %>
   </td>
  </tr>
</table>

<hr />

<div id="category_a">
  <h2>Category A Datasets</h2>


  <% [{:name => :pending, :data => @user.permissions_a.pending}, {:name => :accessible, :data => @user.permissions_a.accessible}].each do |status| %>
    <% unless status[:data].empty? %>
      <h3><%= status[:name].capitalize %> datasets</h3>
      <table id="<%= status[:name] %>">
        <tr><th>Dataset ID</th><th>Dataset Name</th><th><%= status[:name] == :accessible ? "Revoke Permission" : "Add" %></th><th>Delete</th></tr>
        <% status[:data].each do |permission| %>
          <tr>
            <td><%= permission.datasetID %></td>
            <td><%= permission.access_level.datasetname %></td>
            <td>TODO</td>
            <td>
              <%= link_to user_permissions_a_path(@user.user, permission.datasetID), :method => :delete do %>
                <%= image_tag "button_drop.png", :alt => "delete" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </table>
    <% end %>
  <% end %>

 <h3>Add access to a dataset</h3>
  <%= form_for @user do |form| %>
    <%= form.collection_select :datasets_cat_a_to_add, @datasetsCatA, :datasetID, :dataset_description, {}, {:multiple => '1'} %>
    <br />
    <%= form.submit "Add dataset(s)" %>
  <% end %>
</div>
